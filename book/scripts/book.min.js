"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function toggle_category_visibility(e){var n=$(".visibility-switcher."+e).get(0);if(n){var a=Snap(n),t=a.select(".vertical-rect");$(n).hasClass("closed")?($(n).closest(".category").find(".category-articles").stop().slideDown(200),t.stop().animate({transform:"r90 256, 256"},200),opened_array.push(parseInt(e.match(/\d+$/)[0])),save_opened_array()):($(n).closest(".category").find(".category-articles").stop().slideUp(200),t.stop().animate({transform:"r0 256, 256"},200),opened_array=opened_array.filter(function(n){return n!==parseInt(e.match(/\d+$/)[0])}),save_opened_array()),$(n).toggleClass("closed")}}function init_opened_array(){categories.each(function(e,n){$(n).find(".category-article").hasClass("selected")&&(opened_array.includes(e)||opened_array.push(e))}),save_opened_array()}function save_opened_array(){localStorage.setItem("opened_array_"+book_id,JSON.stringify(opened_array))}function get_opened_array(){return null===localStorage.getItem("opened_array_"+book_id)?[]:JSON.parse(localStorage.getItem("opened_array_"+book_id))}function init_actual_state(){opened_array.forEach(function(e,n,a){categories.get(e)&&(set_switcher_to_opened(e),$(categories.get(e)).find(".visibility-switcher").toggleClass("closed"),$(categories.get(e)).find(".category-articles").show())});for(var e=0;e<categories.length;e++)opened_array.includes(e)||$(categories.get(e)).find(".category-articles").hide()}function set_switcher_to_opened(e){Snap($(categories.get(e)).find(".visibility-switcher").get(0)).select(".vertical-rect").attr({transform:"r90 256, 256"})}function init_book_nav_caller(){book_nav=$("nav"),call_nav_button=$(".show-book-nav").find(".menu-item")}function open_book_nav(){book_nav.addClass("shown"),call_nav_button.addClass("active"),$("article").addClass("darker"),is_book_nav_showing=!0}function close_book_nav(){book_nav.removeClass("shown"),call_nav_button.removeClass("active"),$("article").removeClass("darker"),is_book_nav_showing=!1}function toggle_book_nav(){is_book_nav_showing?close_book_nav():open_book_nav()}function adjustAnchor(){var e=$(":target"),n=$("header").outerHeight();e.length>0&&window.scrollTo(0,e.offset().top-n-TOP_MARGIN)}function init_site_menu_caller(){site_menu_caller=$(".show-menu"),vertical_site_menu=$(".site-menu.transformable")}function open_vertical_site_menu(){vertical_site_menu.addClass("shown"),site_menu_caller.addClass("active"),is_site_menu_showing=!0}function close_vertical_site_menu(){vertical_site_menu.removeClass("shown"),site_menu_caller.removeClass("active"),is_site_menu_showing=!1}function toggle_vertical_site_menu(){is_site_menu_showing?close_vertical_site_menu():open_vertical_site_menu()}function disable_touch(){hammer_article&&hammer_article.destroy(),hammer_nav&&hammer_nav.destroy()}function enable_touch(){delete Hammer.defaults.cssProps.userSelect,nav=$("nav"),article=$("article"),nav_width=nav.outerWidth();var e=new Hammer(article.get(0),{dragLockToAxis:!0,dragBlockHorizontal:!0}),n=new Hammer(nav.get(0),{dragLockToAxis:!0,dragBlockHorizontal:!0});e.on("swiperight",function(e){var n=e.changedPointers[0].clientX-e.deltaX;Utils.between(n,0,open_tolerance)&&open_nav()}),n.on("swipeleft",function(){close_nav()}),e.on("panleft panright",function(e){is_opened||(is_moving?(darker_step(),nav_right(e.changedPointers[0].clientX>nav_width?nav_width:e.changedPointers[0].clientX)):Utils.between(e.changedPointers[0].clientX-e.deltaX,0,open_tolerance)&&enable_moving())}),n.on("panleft panright",function(e){e.isFinal||(is_moving?(darker_step(),nav_right(nav_width+e.deltaX>nav_width?nav_width:nav_width+e.deltaX)):enable_moving())}),e.on("panend pancancel",function(){disable_moving(),nav.hasClass("shown")||(nav_right()>nav_width/2?open_nav():close_nav())}),n.on("panend pancancel",function(){disable_moving(),nav.hasClass("shown")&&(nav_right()<nav_width/2?close_nav():open_nav())}),$(".menu-button").click(function(){open_nav()}),$("article, header").click(function(e){!$(e.target).hasClass("menu-button")&&is_opened&&close_nav()})}function open_nav(){clean_nav(),nav.addClass("shown"),article.addClass("darker"),is_opened=!0}function close_nav(){clean_nav(),article.removeClass("darker"),is_opened=!1}function enable_moving(){nav.addClass("moving"),is_moving=!0}function disable_moving(){nav.removeClass("moving"),is_moving=!1}function clean_nav(){article.css("filter",""),nav.removeClass().css("left","")}function darker_step(){var e=1-nav_right()/(2*nav_width);article.css("filter","brightness("+e+")")}function nav_right(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null===e){return nav.position().left+nav_width}nav.css("left",e-nav_width+"px")}var _createClass=function(){function e(e,n){for(var a=0;a<n.length;a++){var t=n[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,a,t){return a&&e(n.prototype,a),t&&e(n,t),n}}(),categories=void 0,opened_array=[];$(function(){categories=$(".category"),opened_array=get_opened_array(),init_opened_array(),init_actual_state(),categories.each(function(e,n){0===$(n).find(".category-articles").children().length&&$(n).find(".visibility-switcher").remove()}),$(".visibility-switcher").click(function(e){toggle_category_visibility($(e.target).closest(".visibility-switcher").attr("class").match(/switcher-[0-9]+/)[0])})});var is_book_nav_showing=!1,book_nav=void 0,call_nav_button=void 0;$(function(){init_book_nav_caller(),call_nav_button.click(function(){toggle_book_nav()}),$(window).click(function(e){$(e.target).closest(call_nav_button).length||$(e.target).closest("nav").length||close_book_nav()})});var TOP_MARGIN=20;$(window).on("hashchange load",adjustAnchor),$(function(){$("body").on("click","a[href^='#']",function(e){window.location.hash===$(this).attr("href")&&(e.preventDefault(),adjustAnchor())})});var is_site_menu_showing=!1,site_menu_caller=void 0,vertical_site_menu=void 0;$(function(){init_site_menu_caller(),site_menu_caller.click(function(){toggle_vertical_site_menu()}),$(window).click(function(e){$(e.target).closest(".menu-item").length||$(e.target).closest(".show-menu").length||close_vertical_site_menu()})});var is_opened=!1,is_moving=!1,nav=void 0,article=void 0,header=void 0,open_tolerance=20,nav_width=void 0,hammer_article=null,hammer_nav=null;$(window).resize(function(){nav_width=$(nav).outerWidth(),window.matchMedia("(max-width: 850px)").matches?enable_touch():disable_touch()}),$(function(){window.matchMedia("(max-width: 850px)").matches?enable_touch():disable_touch()}),$(function(){});var LAYOUT_WIDTH={MINI:445,MOBILE:650,TABLET:850,STRETCH:1100},Layout=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"is_layout",value:function(e){return window.matchMedia("(max-width: "+e+"px)").matches}}]),e}(),Utils=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"between",value:function(e,n,a){var t=void 0,i=void 0;return n>a?(t=a,i=n):(t=n,i=a),e>=t&&e<=i}}]),e}();